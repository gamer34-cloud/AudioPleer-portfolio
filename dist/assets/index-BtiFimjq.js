(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();async function w(){const e=localStorage.getItem("autarisation-token");return await(await fetch("http://localhost:8000/api/tracks",{headers:{Authorization:`Bearer ${e}`}})).json()}async function I(){const e=localStorage.getItem("autarisation-token");return await(await fetch("http://localhost:8000/api/favorites",{headers:{Authorization:`Bearer ${e}`}})).json()}function O(e,t){const{tag:i,id:o,className:n}=V(e),s=t?document.createElementNS(t,i):document.createElement(i);return o&&(s.id=o),n&&(t?s.setAttribute("class",n):s.className=n),s}function V(e){const t=e.split(/([.#])/);let i="",o="";for(let n=1;n<t.length;n+=2)switch(t[n]){case".":i+=` ${t[n+1]}`;break;case"#":o=t[n+1]}return{className:i.trim(),tag:t[0]||"div",id:o}}function k(e,...t){let i;const o=typeof e;if(o==="string")i=O(e);else if(o==="function"){const n=e;i=new n(...t)}else throw new Error("At least one argument required");return N(m(i),t),i}const l=k;k.extend=function(...t){return k.bind(this,...t)};function U(e,t){let i=t;const o=m(e),n=m(i);return i===n&&n.__redom_view&&(i=n.__redom_view),n.parentNode&&(B(i,n,o),o.removeChild(n)),i}function B(e,t,i){const o=t.__redom_lifecycle;if(A(o)){t.__redom_lifecycle={};return}let n=i;for(t.__redom_mounted&&v(t,"onunmount");n;){const s=n.__redom_lifecycle||{};for(const c in o)s[c]&&(s[c]-=o[c]);A(s)&&(n.__redom_lifecycle=null),n=n.parentNode}}function A(e){if(e==null)return!0;for(const t in e)if(e[t])return!1;return!0}const J=["onmount","onremount","onunmount"],G=typeof window<"u"&&"ShadowRoot"in window;function P(e,t,i,o){let n=t;const s=m(e),c=m(n);n===c&&c.__redom_view&&(n=c.__redom_view),n!==c&&(c.__redom_view=n);const r=c.__redom_mounted,d=c.parentNode;if(r&&d!==s&&B(n,c,d),i!=null)if(o){const a=m(i);a.__redom_mounted&&v(a,"onunmount"),s.replaceChild(c,a)}else s.insertBefore(c,m(i));else s.appendChild(c);return Q(n,c,s,d),n}function v(e,t){t==="onmount"||t==="onremount"?e.__redom_mounted=!0:t==="onunmount"&&(e.__redom_mounted=!1);const i=e.__redom_lifecycle;if(!i)return;const o=e.__redom_view;let n=0;o?.[t]?.();for(const s in i)s&&n++;if(n){let s=e.firstChild;for(;s;){const c=s.nextSibling;v(s,t),s=c}}}function Q(e,t,i,o){t.__redom_lifecycle||(t.__redom_lifecycle={});const n=t.__redom_lifecycle,s=i===o;let c=!1;for(const a of J)s||e!==t&&a in e&&(n[a]=(n[a]||0)+1),n[a]&&(c=!0);if(!c){t.__redom_lifecycle={};return}let r=i,d=!1;for((s||r?.__redom_mounted)&&(v(t,s?"onremount":"onmount"),d=!0);r;){const a=r.parentNode;r.__redom_lifecycle||(r.__redom_lifecycle={});const _=r.__redom_lifecycle;for(const b in n)_[b]=(_[b]||0)+n[b];if(d)break;(r.nodeType===Node.DOCUMENT_NODE||G&&r instanceof ShadowRoot||a?.__redom_mounted)&&(v(r,s?"onremount":"onmount"),d=!0),r=a}}function W(e,t,i){const o=m(e);if(typeof t=="object")for(const n in t)q(o,n,t[n]);else q(o,t,i)}function q(e,t,i){e.style[t]=i??""}const T="http://www.w3.org/1999/xlink";function M(e,t,i,o){const n=m(e);if(typeof t=="object")for(const c in t)M(n,c,t[c]);else{const c=n instanceof SVGElement,r=typeof i=="function";if(t==="style"&&typeof i=="object")W(n,i);else if(c&&r)n[t]=i;else if(t==="dataset")F(n,i);else if(!c&&(t in n||r)&&t!=="list")n[t]=i;else{if(c&&t==="xlink"){$(n,i);return}if(t==="class"){K(n,i);return}i==null?n.removeAttribute(t):n.setAttribute(t,i)}}}function K(e,t){t==null?e.removeAttribute("class"):e.classList?e.classList.add(t):typeof e.className=="object"&&e.className&&e.className.baseVal?e.className.baseVal=`${e.className.baseVal} ${t}`.trim():e.className=`${e.className} ${t}`.trim()}function $(e,t,i){if(typeof t=="object")for(const o in t)$(e,o,t[o]);else i!=null?e.setAttributeNS(T,t,i):e.removeAttributeNS(T,t,i)}function F(e,t,i){if(typeof t=="object")for(const o in t)F(e,o,t[o]);else i!=null?e.dataset[t]=i:delete e.dataset[t]}function X(e){return document.createTextNode(e??"")}function N(e,t,i){for(const o of t){if(o!==0&&!o)continue;const n=typeof o;n==="function"?o(e):n==="string"||n==="number"?e.appendChild(X(o)):H(m(o))?P(e,o):o.length?N(e,o):n==="object"&&M(e,o,null)}}function m(e){return e.nodeType&&e||!e.el&&e||m(e.el)}function H(e){return e?.nodeType}function R(e,...t){const i=m(e);let o=z(e,t,i.firstChild);for(;o;){const n=o.nextSibling;U(e,o),o=n}}function z(e,t,i){let o=i;const n=Array(t.length);for(let s=0;s<t.length;s++)n[s]=t[s]&&m(t[s]);for(let s=0;s<t.length;s++){const c=t[s];if(!c)continue;const r=n[s];if(r===o){o=o.nextSibling;continue}if(H(r)){const d=o?.nextSibling,_=c.__redom_index!=null&&d===n[s+1];P(e,c,o,_),_&&(o=d);continue}c.length!=null&&(o=z(e,c,o))}return o}const D="http://www.w3.org/2000/svg";function p(e,...t){let i;const o=typeof e;if(o==="string")i=O(e,D);else if(o==="function"){const n=e;i=new n(...t)}else throw new Error("At least one argument required");return N(m(i),t),i}p.extend=function(...t){return p.bind(this,...t)};p.ns=D;function Y(){const e=localStorage.getItem("username"),t=document.querySelector(".hero__header-text");e?t.textContent=e:t.textContent="user"}async function Z(e){const t=localStorage.getItem("autarisation-token");await fetch("http://localhost:8000/api/favorites",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({trackId:e})})}async function tt(e){const t=localStorage.getItem("autarisation-token");await fetch("http://localhost:8000/api/favorites",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({trackId:e})})}function et(){const e=document.querySelectorAll(".like");w().then(t=>{e.forEach(i=>{i.addEventListener("click",function(o){i.classList.toggle("liked");let n=i.id.split("");n=n.map(c=>parseInt(c)).filter(c=>!isNaN(c)),n=n.join("");const s=Number(n)-1;i.classList.contains("liked")?Z(t[s].id):tt(t[s].id)})})})}function nt(){document.querySelector(".hero__header-button").addEventListener("click",function(t){const i=document.querySelector(".overlay"),o=document.querySelector(".modal-window");if(!i&&!o){let n=function(){s.style.display="none",c.style.display="none"};const s=l("div",{class:"overlay"}),c=l("div",{class:"modal-window"},[l("button",{class:"modal-window__close",ariaLabel:"Кнопка закрытия модального окна",onclick:n},"Закрыть"),l("div",{class:"modal-window__buttons"},[l("a",{class:"modal-window__button",href:"./authorization.html"},"Войти"),l("a",{class:"modal-window__button-sign",href:"./registration.html"},"Зарегестрироваться")])]);document.querySelector(".main").append(s,c)}else i.style.display="flex",o.style.display="flex"})}function ot(){const e=document.querySelectorAll(".table__option"),t=document.querySelectorAll(".option-card");e.forEach((i,o)=>{i.addEventListener("click",function(n){t[o].classList.toggle("option-card--active")})})}async function C(e,t){e.innerHTML="";const i=l("table",{id:"table"},[t.map((o,n)=>l("tr",[l("td",o.id),l("td",[l("div",{class:"table__artist"},[l("button",{class:"table__artist-button"},[l("img",{class:"table__artist-img",src:"./images/img-oblojca.jpg",alt:"Обложка группы Нирваны"}),p("svg",{class:"table__artist-svg",src:"./images/img-oblojca.jpg",alt:"Обложка группы Нирваны"},[p("use",{href:"./images/sprite.svg#icon-play-button"})])]),l("div",{class:"table__artist-content"},[l("span",{class:"table__artist-album"},o.title),l("span",{class:"table__artist-song"},o.artist)])])]),l("td",[l("span",{class:"table__album"},o.artist)]),l("td",[l("div",{class:"table__date"},[l("span",{class:"table__date-text"},`${o.id} дней назад`),l("button",{className:["table__date-like"],class:["like"],ariaLabel:"Кнопка добавить в избранное",type:"button",id:`like-${Number(o.id)}`},[p("svg",{class:"table__icon"},[p("use",{href:"/images/sprite.svg#icon-like"})])])])]),l("td",[l("div",{class:"table__last"},[l("div",{class:"option-card"},[l("button",{class:"option-card__button"},"Удалить")]),l("span",{class:"table__time"},o.duration),l("button",{class:"table__option",ariaLabel:"Кнопка с опциями"},[p("svg",{class:["table__icon--option"],xmlns:"http://www.w3.org/2000/svg"},[p("use",{href:"/images/sprite.svg#icon-option"})])])])])]))]);R(e,[i]),Y(),setTimeout(()=>et(),50),nt(),setTimeout(()=>ot(),50)}const it={text:"",index:0};function h(e=0,t=6,i,o=it){let n=0,s=0;const c=document.getElementById("tracks"),r=document.querySelector(".pagination");c.innerHTML="",r.innerHTML="<ul class='pagination__list'></ul>";const d=document.querySelector(".pagination__list");i!="fav"?w().then(a=>{o.text!=null&&o.text!=null&&o.text!=""&&(a=a.filter(b=>b.title.slice(0,o.index)==o.text));const _=a.slice(e,t);a.forEach((b,E)=>{n++,(n==6||E==0)&&(n=0,s++,d.append(l("button",{class:"pagination__button"},s)))}),C(c,_),j(i)}):I().then(a=>{const _=a.slice(e,t);a.forEach((b,E)=>{n++,(n==6||E==0)&&(n=0,s++,d.append(l("button",{class:"pagination__button"},s)))}),C(c,_),j(i)})}function j(e){const t=document.querySelectorAll(".pagination__button");t.forEach((i,o)=>{i.addEventListener("click",function(n){for(let c of t)c.classList.remove("pagination__button--active");const s=o+1;if(o>0){const c=s*6-6;h(c,s*6,e)}else h(0,6,e);i.classList.add("pagination__button--active")})})}function st(e){const t=document.querySelectorAll(".aside__button"),i=document.querySelectorAll(".aside__button");let o=document.getElementById("tracks");const n=document.querySelector(".pagination");t[1].classList.add("is-active"),i.forEach(s=>{s.addEventListener("click",function(c){for(let r=0;r<i.length;r++)i[r].classList.remove("is-active");s.classList.toggle("is-active"),t[1].classList.contains("is-active")?h(0,6,"base"):t[0].classList.contains("is-active")&&I().then(r=>{try{if(r.length>0)h(0,6,"fav"),setTimeout(()=>{document.querySelectorAll(".like").forEach((a,_)=>{_<=_-1&&a.classList.add("liked")})},150);else{const d=new Error("войдите или добавте песню в избранные");throw d.name="Authorization",d}}catch(d){d instanceof Error&&(n.innerHTML="",R(o,[l("div",{class:"error"},[l("h2",{class:"error__title"},d.message)])]))}})})}),h(0,6,"base")}function L(e,t){return Math.floor(Math.random()*(t-e+1))+e}let u=new Audio,f=0,x=.5;const S=document.querySelector(".pleer__buttons-shufle"),g=document.querySelector(".pleer__buttons-play");rt();function ct(){const e=document.querySelectorAll(".table__artist-button"),t=document.querySelector(".pleer__artist-song"),i=document.querySelector(".pleer__artist-name"),o=document.querySelector(".pleer__bottom-end"),n=localStorage.getItem("last-song");if(n){const s=JSON.parse(n);t.textContent=s.title,i.textContent=s.description,o.textContent=s.duration}e.forEach((s,c)=>{s.addEventListener("click",function(r){y(c)})})}function lt(e){const t=atob(e),i=new ArrayBuffer(t.length),o=new Uint8Array(i);for(let c=0;c<t.length;c++)o[c]=t.charCodeAt(c);const n=new Blob([o],{type:"audio/mpeg"}),s=URL.createObjectURL(n);return new Audio(s)}function y(e){const t=document.querySelector(".pleer__bottom-end"),i=document.querySelector(".pleer__artist-song"),o=document.querySelector(".pleer__artist-name"),n=document.querySelector(".pleer__bottom-end");f=e,w().then(s=>{u&&(u.pause(),u.src="",u.currentTime=0,u.load()),i.textContent=s[f].title,o.textContent=s[f].artist,n.textContent=String(s[f].duration);const r={id:s[f].id,title:i.textContent,description:o.textContent,duration:String(n.textContent)};localStorage.setItem("last-song",JSON.stringify(r)),u=lt(s[f].encoded_audio),t.textContent=String(s[f].duration),u.play(),u.volume=x,g.classList.add("pleer__buttons-play--active"),_t(),pt()})}function rt(){ft(),ut(),dt(),mt()}function at(){const e=document.querySelector(".pleer__buttons-forward");document.querySelector(".pleer__buttons-back").addEventListener("click",function(i){const o=L(0,50);f!=0&&(S.classList.contains("pleer__buttons-shufle--active")&&y(o),f--,y(f))}),e.addEventListener("click",function(i){const o=L(0,50);S.classList.contains("pleer__buttons-shufle--active")&&y(o),f++,y(f)})}function ut(){const e=document.querySelector(".pleer__buttons-repeat");e.addEventListener("click",function(t){e.classList.contains("pleer__buttons-repeat--active")?(u.loop=!1,e.classList.remove("pleer__buttons-repeat--active")):(u.loop=!0,e.classList.add("pleer__buttons-repeat--active"))})}function dt(){S.addEventListener("click",function(e){S.classList.toggle("pleer__buttons-shufle--active")})}function ft(){const e=document.querySelector("#range");e.addEventListener("input",function(t){x=Number(e.value)/100,u.volume=x})}function mt(){g.addEventListener("click",function(e){g.classList.contains("pleer__buttons-play--active")&&u?(u.pause(),g.classList.remove("pleer__buttons-play--active")):(u.play(),g.classList.add("pleer__buttons-play--active"))})}function _t(){const e=document.querySelector("#scroll");u.addEventListener("loadedmetadata",()=>{e.max=String(Math.floor(u.duration)),e.addEventListener("input",function(t){u.currentTime=Number(e.value)})})}function pt(){const e=L(0,50),t=document.querySelector("#scroll"),i=document.querySelector(".pleer__bottom-start");u.ontimeupdate=()=>{t.value=String(u.currentTime),u.currentTime>=u.duration&&(S.classList.contains("pleer__buttons-shufle--active")?y(e):(f++,y(f)));const o=Math.floor(u.currentTime),n=Math.floor(o/60),s=o%60;i.textContent=`${n}:${s.toString().padStart(2,"0")}`}}function bt(e){const t=document.querySelector("#input-search");t.addEventListener("input",function(i){w().then(o=>{const n={text:t.value,index:t.value.length};h(0,6,"base",n)})})}window.onload=function(){document.getElementById("tracks"),setTimeout(()=>ct(),1e3),st(),bt(),at()};
